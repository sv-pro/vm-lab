#!/usr/bin/env bpftrace

// Simplest possible DNS monitor - track processes doing DNS lookups
BEGIN { printf("ðŸ” DNS Process Monitor - Shows when programs do DNS lookups\n"); }

// Monitor any process that opens files containing "resolv" (like /etc/resolv.conf)
tracepoint:syscalls:sys_enter_openat /str(args->filename) =~ /resolv/ || str(args->filename) =~ /hosts/
{
    printf("ðŸ“– %s (PID %d) accessed DNS config: %s\n", comm, pid, str(args->filename));
}